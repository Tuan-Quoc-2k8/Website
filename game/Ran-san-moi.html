<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Snake Game</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
body{font-family:'Segoe UI',sans-serif;display:flex;justify-content:center;align-items:center;min-height:100vh;transition:background-color .3s;overflow:hidden;padding:10px}
.game-container{display:flex;gap:20px;z-index:1;width:100%;max-width:1400px;justify-content:center}
@media (max-width:1024px){.game-container{flex-direction:column;align-items:center}}
.panel{background:rgba(0,0,0,.8);backdrop-filter:blur(10px);padding:20px;border-radius:8px;color:#fff;box-shadow:0 4px 20px rgba(0,0,0,.3);flex-shrink:0;width:220px}
@media (max-width:1024px){.panel{width:100%;max-width:600px}}
.panel h3{font-size:18px;margin-bottom:15px;color:#4ade80;border-bottom:2px solid #4ade80;padding-bottom:8px}
.stat{display:flex;justify-content:space-between;margin:10px 0;font-size:14px}
.game-wrapper{position:relative;display:flex;justify-content:center;align-items:center;width:100%;max-width:min(90vw,90vh,600px)}
#c{border:4px solid rgba(255,255,255,.2);border-radius:8px;box-shadow:0 10px 40px rgba(0,0,0,.5);width:100%;height:auto;aspect-ratio:1;touch-action:none}
.overlay{position:absolute;top:0;left:0;width:100%;height:100%;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,.9);backdrop-filter:blur(10px);border-radius:8px;z-index:10}
.overlay.hide{display:none}
.content{text-align:center;color:#fff;padding:40px 20px;max-width:90%;max-height:90%;overflow-y:auto}
.content h1{font-size:clamp(36px,8vw,64px);margin-bottom:10px;animation:pulse 2s infinite}
.content h2{font-size:clamp(28px,6vw,48px);margin-bottom:20px}
.btn-group{display:flex;flex-direction:column;gap:12px;margin-top:20px}
.btn{padding:clamp(10px,2vw,15px) clamp(25px,5vw,40px);font-size:clamp(14px,3vw,18px);font-weight:bold;border:none;border-radius:8px;cursor:pointer;transition:all .3s;display:flex;align-items:center;justify-content:center;gap:10px}
.btn:hover{transform:scale(1.05)}
.btn-p{background:#22c55e;color:#fff}
.btn-s{background:#a855f7;color:#fff}
.btn-g{background:#6b7280;color:#fff}
.btn-set{background:#3b82f6;color:#fff}
.map-sel{display:flex;gap:15px;margin:20px 0;justify-content:center;flex-wrap:wrap}
.map-card{background:linear-gradient(135deg,#3b82f6,#8b5cf6);padding:clamp(15px,4vw,30px);border-radius:12px;min-width:clamp(200px,50vw,300px)}
.arrow{background:rgba(255,255,255,.1);border:none;padding:12px;border-radius:8px;cursor:pointer;color:#fff;font-size:20px;transition:all .3s}
.arrow:hover:not(:disabled){background:rgba(255,255,255,.2)}
.arrow:disabled{opacity:.3;cursor:not-allowed}
.skin-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:12px;margin:20px 0;max-width:600px}
.skin-card{background:rgba(255,255,255,.05);border:2px solid rgba(255,255,255,.3);padding:15px;border-radius:8px;cursor:pointer;transition:all .3s}
.skin-card:hover{transform:scale(1.05)}
.skin-card.active{border-color:#fff;background:rgba(255,255,255,.2);box-shadow:0 0 20px rgba(255,255,255,.3)}
.colors{display:flex;gap:10px;justify-content:center;margin-top:10px}
.color{width:30px;height:30px;border-radius:4px;box-shadow:0 2px 8px rgba(0,0,0,.3)}
.lang-btn{padding:10px 20px;border:2px solid rgba(255,255,255,.3);background:rgba(255,255,255,.1);color:#fff;border-radius:5px;cursor:pointer;transition:all .3s;font-size:clamp(12px,3vw,14px)}
.lang-btn.active{background:#3b82f6;border-color:#3b82f6}
.score-box{background:rgba(0,0,0,.5);padding:20px;border-radius:8px;margin:20px 0}
.score-item{display:flex;justify-content:space-between;margin:8px 0;font-size:clamp(12px,3vw,14px)}
.stats{display:grid;grid-template-columns:repeat(2,1fr);gap:12px;margin-top:15px}
.stat-box{background:rgba(0,0,0,.5);padding:12px;border-radius:8px;text-align:center}
.mobile-ctrl{display:none;position:fixed;bottom:10px;right:10px;z-index:100;opacity:0;pointer-events:none;transition:opacity .3s}
.mobile-ctrl.show{opacity:1;pointer-events:auto}
@media (max-width:768px){.mobile-ctrl{display:grid;grid-template-columns:repeat(3,50px);grid-template-rows:repeat(3,50px);gap:4px}}
.m-btn{background:rgba(0,0,0,.4);backdrop-filter:blur(10px);border:1px solid rgba(255,255,255,.2);border-radius:6px;color:#fff;font-size:20px;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .2s;user-select:none}
.m-btn:active{background:rgba(255,255,255,.3);transform:scale(.95)}
.ctrl-toggle{display:none;position:fixed;bottom:10px;left:10px;z-index:100;background:rgba(0,0,0,.6);backdrop-filter:blur(10px);border:2px solid rgba(255,255,255,.3);border-radius:50%;width:50px;height:50px;color:#fff;font-size:24px;align-items:center;justify-content:center;cursor:pointer;transition:all .3s}
.ctrl-toggle:active{transform:scale(.95)}
@media (max-width:768px){.ctrl-toggle{display:flex}}
.tutorial{margin-top:15px;padding-top:15px;border-top:1px solid rgba(255,255,255,0.2)}
.tutorial p{color:#4ade80;font-size:13px;margin:5px 0}
.tutorial .hint{font-size:11px;color:rgba(255,255,255,0.6);margin-top:3px}
.tutorial .start-msg{color:#fbbf24;font-weight:bold;font-size:14px;margin-top:10px;animation:pulse 2s infinite}
.hide{display:none!important}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.6}}
</style>
</head>
<body>
<div class="game-container">
<div class="panel">
<h3 data-t="gameStats">Game Stats</h3>
<div class="stat"><span data-t="score">Score:</span><span id="sc">0</span></div>
<div class="stat"><span data-t="level">Level:</span><span id="lv">1</span></div>
<div class="stat"><span data-t="length">Length:</span><span id="ln">1</span></div>
<div class="stat"><span data-t="time">Time:</span><span id="tm">0s</span></div>
<div class="stat hide" id="cb"><span data-t="combo">Combo:</span><span id="cbv">x0</span></div>
<div class="stat"><span data-t="mode">Mode:</span><span id="md">Classic</span></div>
</div>
<div class="game-wrapper">
<canvas id="c" width="400" height="400"></canvas>
<div id="pause" class="overlay hide"><div class="content"><div style="font-size:64px">‚è∏</div><h2 data-t="paused">Paused</h2><button class="btn btn-p" onclick="g.tp()" data-t="resume">Resume</button></div></div>
<div id="intro" class="overlay"><div class="content"><h1>SNAKE</h1><div class="btn-group"><button class="btn btn-p" onclick="g.sm()">‚ñ∂ <span data-t="play">Play</span></button><button class="btn btn-s" onclick="g.ss()">üé® <span data-t="skins">Skins</span></button><button class="btn btn-set" onclick="g.set()">‚öôÔ∏è <span data-t="settings">Settings</span></button></div></div></div>
<div id="setscr" class="overlay hide"><div class="content"><h2 data-t="settings">Settings</h2><div style="display:flex;gap:10px;justify-content:center;margin:20px 0"><button class="lang-btn active" onclick="g.sl('en')" id="len">English</button><button class="lang-btn" onclick="g.sl('vi')" id="lvi">Ti·∫øng Vi·ªát</button><button class="lang-btn" onclick="g.sl('ja')" id="lja">Êó•Êú¨Ë™û</button><button class="lang-btn" onclick="g.sl('ko')" id="lko">ÌïúÍµ≠Ïñ¥</button></div><button class="btn btn-g" onclick="g.si()" data-t="back">Back</button></div></div>
<div id="map" class="overlay hide"><div class="content"><h2 data-t="selectMap">Select Map</h2><div class="map-sel"><button class="arrow" onclick="g.pm()">‚óÄ</button><div class="map-card"><h3 id="mn"></h3><p id="mds"></p></div><button class="arrow" onclick="g.nm()">‚ñ∂</button></div><div class="btn-group"><button class="btn btn-p" onclick="g.st()" data-t="startGame">Start Game</button><button class="btn btn-g" onclick="g.si()" data-t="back">Back</button></div></div></div>
<div id="skin" class="overlay hide"><div class="content"><h2 data-t="customizeSkins">Customize Skins</h2><div class="skin-grid" id="sg"></div><button class="btn btn-g" onclick="g.si()" data-t="back">Back to Menu</button></div></div>
<div id="over" class="overlay hide"><div class="content"><h2 style="color:#ef4444" data-t="gameOver">Game Over!</h2><div class="score-box"><p style="font-size:48px;color:#fbbf24" id="fs">0</p><div class="score-item"><span data-t="baseScore">Base:</span><span id="bs">0</span></div><div class="score-item"><span data-t="comboBonus">Combo:</span><span id="cs">0</span></div><div class="score-item"><span data-t="speedBonus">Speed:</span><span id="ts">0</span></div></div><div class="stats"><div class="stat-box"><p data-t="level">Level</p><p id="fl">1</p></div><div class="stat-box"><p data-t="length">Length</p><p id="fln">1</p></div><div class="stat-box"><p data-t="time">Time</p><p id="ft">0s</p></div><div class="stat-box"><p data-t="maxCombo">Max Combo</p><p id="fc">x0</p></div></div><div class="btn-group"><button class="btn btn-p" onclick="g.rs()">üîÑ <span data-t="restartGame">Restart</span></button><button class="btn btn-g" onclick="g.bm()">üè† <span data-t="mainMenu">Menu</span></button></div></div></div>
</div>
<div class="panel"><h3 data-t="controls">Controls</h3><div class="tutorial"><p data-t="keyControls">üéÆ Arrow Keys / WASD</p><p data-t="pauseKey">‚è∏ P or ESC to Pause</p><p class="hint" data-t="mobileHint">üì± Swipe on game to move</p><p class="start-msg hide" id="startmsg" data-t="startHint">Press any direction to start</p></div></div>
</div>
<div class="ctrl-toggle" id="ctoggle" ontouchstart="g.tmc()">üéÆ</div>
<div class="mobile-ctrl" id="mctrl"><div class="m-btn" style="grid-column:2;grid-row:1" ontouchstart="g.mc('up')">‚Üë</div><div class="m-btn" style="grid-column:1;grid-row:2" ontouchstart="g.mc('left')">‚Üê</div><div class="m-btn" style="grid-column:2;grid-row:2;font-size:16px" ontouchstart="g.tp()">‚è∏</div><div class="m-btn" style="grid-column:3;grid-row:2" ontouchstart="g.mc('right')">‚Üí</div><div class="m-btn" style="grid-column:2;grid-row:3" ontouchstart="g.mc('down')">‚Üì</div></div>
<script>
const T={en:{gameStats:'Game Stats',score:'Score:',level:'Level:',length:'Length:',time:'Time:',combo:'Combo:',mode:'Mode:',paused:'Paused',resume:'Resume',play:'Play',skins:'Skins',settings:'Settings',back:'Back',selectMap:'Select Map',startGame:'Start Game',customizeSkins:'Customize Skins',gameOver:'Game Over!',baseScore:'Base:',comboBonus:'Combo:',speedBonus:'Speed:',maxCombo:'Max Combo',restartGame:'Restart',mainMenu:'Menu',controls:'Controls',classicMode:'Classic Mode',classicDesc:'Hit walls = Game Over',mazeMode:'Maze Mode',mazeDesc:'Navigate obstacles',infiniteMode:'Infinite Mode',infiniteDesc:'Wrap around walls',classic:'Classic',neon:'Neon Cyber',pixel:'Pixel Retro',nature:'Nature',space:'Space',dark:'Dark Mode',keyControls:'Arrow Keys / WASD',pauseKey:'P or ESC to Pause',mobileHint:'Swipe on game to move',startHint:'Press any direction to start'},vi:{gameStats:'Th·ªëng K√™',score:'ƒêi·ªÉm:',level:'C·∫•p:',length:'ƒê·ªô d√†i:',time:'Th·ªùi gian:',combo:'Combo:',mode:'Ch·∫ø ƒë·ªô:',paused:'T·∫°m D·ª´ng',resume:'Ti·∫øp T·ª•c',play:'Ch∆°i',skins:'Giao Di·ªán',settings:'C√†i ƒê·∫∑t',back:'Quay L·∫°i',selectMap:'Ch·ªçn B·∫£n ƒê·ªì',startGame:'B·∫Øt ƒê·∫ßu',customizeSkins:'T√πy Ch·ªânh',gameOver:'K·∫øt Th√∫c!',baseScore:'C∆° B·∫£n:',comboBonus:'Combo:',speedBonus:'T·ªëc ƒê·ªô:',maxCombo:'Combo T·ªëi ƒêa',restartGame:'Ch∆°i L·∫°i',mainMenu:'Menu',controls:'ƒêi·ªÅu Khi·ªÉn',classicMode:'Ch·∫ø ƒê·ªô C·ªï ƒêi·ªÉn',classicDesc:'Ch·∫°m t∆∞·ªùng = Thua',mazeMode:'Ch·∫ø ƒê·ªô M√™ Cung',mazeDesc:'V∆∞·ª£t ch∆∞·ªõng ng·∫°i v·∫≠t',infiniteMode:'Ch·∫ø ƒê·ªô V√¥ H·∫°n',infiniteDesc:'Xuy√™n qua t∆∞·ªùng',classic:'C·ªï ƒêi·ªÉn',neon:'Neon Cyber',pixel:'Pixel Retro',nature:'Thi√™n Nhi√™n',space:'Kh√¥ng Gian',dark:'Ch·∫ø ƒê·ªô T·ªëi',keyControls:'Ph√≠m M≈©i T√™n / WASD',pauseKey:'P ho·∫∑c ESC ƒë·ªÉ t·∫°m d·ª´ng',mobileHint:'Vu·ªët tr√™n m√†n h√¨nh ƒë·ªÉ di chuy·ªÉn',startHint:'Nh·∫•n h∆∞·ªõng b·∫•t k·ª≥ ƒë·ªÉ b·∫Øt ƒë·∫ßu'},ja:{gameStats:'„Ç≤„Éº„É†Áµ±Ë®à',score:'„Çπ„Ç≥„Ç¢:',level:'„É¨„Éô„É´:',length:'Èï∑„Åï:',time:'ÊôÇÈñì:',combo:'„Ç≥„É≥„Éú:',mode:'„É¢„Éº„Éâ:',paused:'‰∏ÄÊôÇÂÅúÊ≠¢',resume:'ÂÜçÈñã',play:'„Éó„É¨„Ç§',skins:'„Çπ„Ç≠„É≥',settings:'Ë®≠ÂÆö',back:'Êàª„Çã',selectMap:'„Éû„ÉÉ„ÉóÈÅ∏Êäû',startGame:'„Ç≤„Éº„É†ÈñãÂßã',customizeSkins:'„Ç´„Çπ„Çø„Éû„Ç§„Ç∫',gameOver:'„Ç≤„Éº„É†„Ç™„Éº„Éê„Éº!',baseScore:'Âü∫Êú¨:',comboBonus:'„Ç≥„É≥„Éú:',speedBonus:'„Çπ„Éî„Éº„Éâ:',maxCombo:'ÊúÄÂ§ß„Ç≥„É≥„Éú',restartGame:'ÂÜç„Çπ„Çø„Éº„Éà',mainMenu:'„É°„Éã„É•„Éº',controls:'Êìç‰Ωú',classicMode:'„ÇØ„É©„Ç∑„ÉÉ„ÇØ',classicDesc:'Â£Å„Å´ÂΩì„Åü„Çã„Å®„Ç≤„Éº„É†„Ç™„Éº„Éê„Éº',mazeMode:'Ëø∑Ë∑Ø„É¢„Éº„Éâ',mazeDesc:'ÈöúÂÆ≥Áâ©„ÇíÈÅø„Åë„Çã',infiniteMode:'ÁÑ°Èôê„É¢„Éº„Éâ',infiniteDesc:'Â£Å„Çí„Åô„ÇäÊäú„Åë„Çã',classic:'„ÇØ„É©„Ç∑„ÉÉ„ÇØ',neon:'„Éç„Ç™„É≥',pixel:'„Éî„ÇØ„Çª„É´',nature:'Ëá™ÁÑ∂',space:'„Çπ„Éö„Éº„Çπ',dark:'„ÉÄ„Éº„ÇØ',keyControls:'Áü¢Âç∞„Ç≠„Éº / WASD',pauseKey:'P„Åæ„Åü„ÅØESC„Åß‰∏ÄÊôÇÂÅúÊ≠¢',mobileHint:'„Çπ„ÉØ„Ç§„Éó„ÅßÁßªÂãï',startHint:'ÊñπÂêë„Ç≠„Éº„ÅßÈñãÂßã'},ko:{gameStats:'Í≤åÏûÑ ÌÜµÍ≥Ñ',score:'Ï†êÏàò:',level:'Î†àÎ≤®:',length:'Í∏∏Ïù¥:',time:'ÏãúÍ∞Ñ:',combo:'ÏΩ§Î≥¥:',mode:'Î™®Îìú:',paused:'ÏùºÏãú Ï†ïÏßÄ',resume:'Ïû¨Í∞ú',play:'ÌîåÎ†àÏù¥',skins:'Ïä§ÌÇ®',settings:'ÏÑ§Ï†ï',back:'Îí§Î°ú',selectMap:'Îßµ ÏÑ†ÌÉù',startGame:'Í≤åÏûÑ ÏãúÏûë',customizeSkins:'Ïª§Ïä§ÌÑ∞ÎßàÏù¥Ï¶à',gameOver:'Í≤åÏûÑ Ïò§Î≤Ñ!',baseScore:'Í∏∞Î≥∏:',comboBonus:'ÏΩ§Î≥¥:',speedBonus:'ÏÜçÎèÑ:',maxCombo:'ÏµúÎåÄ ÏΩ§Î≥¥',restartGame:'Îã§Ïãú ÏãúÏûë',mainMenu:'Î©îÎâ¥',controls:'Ï°∞Ïûë',classicMode:'ÌÅ¥ÎûòÏãù Î™®Îìú',classicDesc:'Î≤ΩÏóê ÎãøÏúºÎ©¥ Í≤åÏûÑ Ïò§Î≤Ñ',mazeMode:'ÎØ∏Î°ú Î™®Îìú',mazeDesc:'Ïû•Ïï†Î¨º ÌîºÌïòÍ∏∞',infiniteMode:'Î¨¥Ìïú Î™®Îìú',infiniteDesc:'Î≤Ω ÌÜµÍ≥º',classic:'ÌÅ¥ÎûòÏãù',neon:'ÎÑ§Ïò®',pixel:'ÌîΩÏÖÄ',nature:'ÏûêÏó∞',space:'Ïö∞Ï£º',dark:'Îã§ÌÅ¨',keyControls:'ÌôîÏÇ¥Ìëú ÌÇ§ / WASD',pauseKey:'P ÎòêÎäî ESCÎ°ú ÏùºÏãú Ï†ïÏßÄ',mobileHint:'Ïä§ÏôÄÏù¥ÌîÑÎ°ú Ïù¥Îèô',startHint:'Î∞©Ìñ•ÌÇ§Î°ú ÏãúÏûë'}};
const SK={classic:{name:'classic',s:{h:'#2d5016',b:'#4a7c23',g:'#6bc947'},a:'#dc2626',bg:'#1a1a1a',p:'#6bc947'},neon:{name:'neon',s:{h:'#ff00ff',b:'#00ffff',g:'#ff00ff'},a:'#ffff00',bg:'#0a0a1a',p:'#00ffff'},pixel:{name:'pixel',s:{h:'#ff6b6b',b:'#feca57',g:'#feca57'},a:'#48dbfb',bg:'#2c2c54',p:'#48dbfb'},nature:{name:'nature',s:{h:'#2d6a4f',b:'#52b788',g:'#95d5b2'},a:'#e63946',bg:'#d8f3dc',p:'#52b788'},space:{name:'space',s:{h:'#4361ee',b:'#7209b7',g:'#4361ee'},a:'#f72585',bg:'#0d1b2a',p:'#7209b7'},dark:{name:'dark',s:{h:'#495057',b:'#6c757d',g:'#adb5bd'},a:'#e63946',bg:'#212529',p:'#6c757d'}};
const MP=[{id:'classic',n:'classicMode',d:'classicDesc'},{id:'maze',n:'mazeMode',d:'mazeDesc'},{id:'infinite',n:'infiniteMode',d:'infiniteDesc'}];
const GS=20,CS=20,SP=150;
function G(){this.cv=document.getElementById('c');this.cx=this.cv.getContext('2d');this.sm_=0;this.sk_='classic';this.ln='en';this.st_='intro';this.sn=[{x:10,y:10}];this.dr={x:0,y:0};this.nd={x:0,y:0};this.ap={x:15,y:10};this.sc=0;this.lv=1;this.co=0;this.sp=SP;this.ob=[];this.pt=[];this.pa=false;this.go=false;this.gs=false;this.tt=0;this.sb={b:0,c:0,t:0};this.lt=Date.now();this.lp=null;this.ti=null;this.isn=[{x:10,y:10},{x:9,y:10},{x:8,y:10}];this.idr={x:1,y:0};this.tsx=0;this.tsy=0;this.mcs=false;this.in();}
G.prototype.in=function(){this.se();this.rsg();this.umd();this.sia();this.ut();document.querySelectorAll('[data-t]').forEach(e=>{const k=e.getAttribute('data-t');if(T[this.ln][k])e.textContent=T[this.ln][k];});document.body.style.backgroundColor=SK[this.sk_].bg;};
G.prototype.se=function(){const s=this;document.addEventListener('keydown',e=>s.hk(e));window.addEventListener('blur',()=>{if(s.st_==='playing'&&!s.go&&!s.pa)s.tp();});const c=s.cv;c.addEventListener('touchstart',e=>{e.preventDefault();const t=e.touches[0];s.tsx=t.clientX;s.tsy=t.clientY;},{passive:false});c.addEventListener('touchmove',e=>e.preventDefault(),{passive:false});c.addEventListener('touchend',e=>{e.preventDefault();const t=e.changedTouches[0];const dx=t.clientX-s.tsx;const dy=t.clientY-s.tsy;const ad=Math.abs(dx);const ay=Math.abs(dy);if(ad<20&&ay<20)return;let nd=null;if(ad>ay)nd=dx>0?{x:1,y:0}:{x:-1,y:0};else nd=dy>0?{x:0,y:1}:{x:0,y:-1};if(s.go||s.pa)return;if(!s.gs){s.gs=true;s.dr=nd;s.nd=nd;s.usm();return;}if(s.sn.length>=2&&nd.x===-s.dr.x&&nd.y===-s.dr.y)return;s.nd=nd;},{passive:false});};
G.prototype.hk=function(e){if(this.go)return;const k=e.key;let nd=null;if(k==='ArrowUp'||k==='w'||k==='W')nd={x:0,y:-1};else if(k==='ArrowDown'||k==='s'||k==='S')nd={x:0,y:1};else if(k==='ArrowLeft'||k==='a'||k==='A')nd={x:-1,y:0};else if(k==='ArrowRight'||k==='d'||k==='D')nd={x:1,y:0};else if(k==='p'||k==='P'||k==='Escape'){this.tp();return;}else return;if(this.pa)return;if(!this.gs){this.gs=true;this.dr=nd;this.nd=nd;this.usm();return;}if(this.sn.length>=2&&nd.x===-this.dr.x&&nd.y===-this.dr.y)return;this.nd=nd;};
G.prototype.sia=function(){const s=this;setInterval(()=>{if(s.st_!=='intro')return;if(Math.random()<.1){const ds=[{x:1,y:0},{x:-1,y:0},{x:0,y:1},{x:0,y:-1}];let nd,at=0,ov;do{nd=ds[Math.floor(Math.random()*ds.length)];const h=s.isn[0];const th={x:h.x+nd.x,y:h.y+nd.y};if(th.x<0)th.x=GS-1;if(th.x>=GS)th.x=0;if(th.y<0)th.y=GS-1;if(th.y>=GS)th.y=0;ov=s.isn.length>1&&th.x===s.isn[1].x&&th.y===s.isn[1].y;at++;}while(ov&&at<10);if(at<10)s.idr=nd;}const h=s.isn[0];const nh={x:h.x+s.idr.x,y:h.y+s.idr.y};if(nh.x<0)nh.x=GS-1;if(nh.x>=GS)nh.x=0;if(nh.y<0)nh.y=GS-1;if(nh.y>=GS)nh.y=0;s.isn.unshift(nh);s.isn.pop();s.rd();},200);};
G.prototype.gm=function(lv){const o=[];const d=Math.min(.1+lv*.02,.25);const ct=Math.floor(GS*GS*d);for(let i=0;i<ct;i++){let x,y,at=0,cl;do{x=Math.floor(Math.random()*(GS-4))+2;y=Math.floor(Math.random()*(GS-4))+2;at++;cl=o.some(ob=>ob.x===x&&ob.y===y);}while(at<50&&(cl||(x===10&&y===10)||(x===15&&y===10)));if(at<50)o.push({x,y});}return o;};
G.prototype.gap=function(){let na,at=0,cl;do{na={x:Math.floor(Math.random()*GS),y:Math.floor(Math.random()*GS)};at++;cl=this.sn.some(s=>s.x===na.x&&s.y===na.y)||this.ob.some(o=>o.x===na.x&&o.y===na.y);}while(at<100&&cl);this.ap=na;};
G.prototype.cp=function(x,y){for(let i=0;i<8;i++)this.pt.push({x:x*CS+CS/2,y:y*CS+CS/2,vx:(Math.random()-.5)*4,vy:(Math.random()-.5)*4,l:1});};
G.prototype.up=function(){this.pt=this.pt.filter(p=>{p.x+=p.vx;p.y+=p.vy;p.vy+=.2;p.l-.05;return p.l>0;});};
G.prototype.ig=function(){this.sn=[{x:10,y:10},{x:9,y:10}];this.dr={x:0,y:0};this.nd={x:0,y:0};this.sc=0;this.lv=1;this.co=0;this.sp=SP;this.pa=false;this.go=false;this.gs=false;this.tt=0;this.lt=Date.now();this.pt=[];this.sb={b:0,c:0,t:0};if(MP[this.sm_].id==='maze')this.ob=this.gm(this.lv);else this.ob=[];this.gap();document.getElementById('pause').classList.add('hide');document.getElementById('startmsg').classList.remove('hide');this.ut();this.rd();};
G.prototype.slp=function(){if(this.lp)clearInterval(this.lp);if(this.ti)clearInterval(this.ti);const s=this;this.lp=setInterval(()=>{if(!s.pa&&!s.go&&s.gs){s.upd();s.up();}s.rd();},this.sp);this.ti=setInterval(()=>{if(!s.pa&&!s.go&&s.gs){s.tt++;s.ut();}},1000);};
G.prototype.upd=function(){this.dr=this.nd;const h=this.sn[0];const nh={x:h.x+this.dr.x,y:h.y+this.dr.y};const mm=MP[this.sm_].id;if(mm==='infinite'){if(nh.x<0)nh.x=GS-1;if(nh.x>=GS)nh.x=0;if(nh.y<0)nh.y=GS-1;if(nh.y>=GS)nh.y=0;}if(mm==='classic'||mm==='maze'){if(nh.x<0||nh.x>=GS||nh.y<0||nh.y>=GS){this.eg();return;}}if(mm==='maze'){if(this.ob.some(o=>o.x===nh.x&&o.y===nh.y)){this.eg();return;}}if(this.sn.length>=5&&this.sn.some(s=>s.x===nh.x&&s.y===nh.y)){this.eg();return;}this.sn.unshift(nh);if(nh.x===this.ap.x&&nh.y===this.ap.y){const n=Date.now();const td=n-this.lt;this.lt=n;const es=10;this.co++;const cbo=(this.co-1)*2;const tbo=td<2000?5:0;const te=es+cbo+tbo;this.sc+=te;this.sb.b+=es;this.sb.c+=cbo;this.sb.t+=tbo;this.cp(this.ap.x,this.ap.y);this.gap();if(this.sc%50===0){this.lv++;this.sp=Math.max(50,this.sp-10);if(mm==='maze')this.ob=this.gm(this.lv);clearInterval(this.lp);this.slp();}}else{this.sn.pop();if(this.co>0)this.co=0;}this.ut();};
G.prototype.rd=function(){const sk=SK[this.sk_];this.cx.fillStyle=sk.bg;this.cx.fillRect(0,0,this.cv.width,this.cv.height);this.cx.strokeStyle='rgba(255,255,255,0.03)';this.cx.lineWidth=1;for(let i=0;i<=GS;i++){this.cx.beginPath();this.cx.moveTo(i*CS,0);this.cx.lineTo(i*CS,GS*CS);this.cx.stroke();this.cx.beginPath();this.cx.moveTo(0,i*CS);this.cx.lineTo(GS*CS,i*CS);this.cx.stroke();}if(this.st_==='intro'){for(let i=0;i<this.isn.length;i++){const sg=this.isn[i];const ih=(i===0);this.cx.fillStyle=ih?sk.s.h:sk.s.b;this.cx.fillRect(sg.x*CS,sg.y*CS,CS-2,CS-2);if(ih){this.cx.fillStyle='rgba(255,255,255,0.8)';this.cx.fillRect(sg.x*CS+CS/3,sg.y*CS+CS/4,3,3);this.cx.fillRect(sg.x*CS+2*CS/3,sg.y*CS+CS/4,3,3);}}}else if(this.st_==='playing'){if(MP[this.sm_].id==='maze'){for(const ob of this.ob){this.cx.fillStyle='#666';this.cx.fillRect(ob.x*CS,ob.y*CS,CS-2,CS-2);}}const t=Date.now()/1000;const as=Math.sin(t*4)*.15+1;this.cx.fillStyle=sk.a;this.cx.shadowBlur=20;this.cx.shadowColor=sk.a;this.cx.beginPath();this.cx.arc(this.ap.x*CS+CS/2,this.ap.y*CS+CS/2,(CS/2-2)*as,0,Math.PI*2);this.cx.fill();this.cx.shadowBlur=0;for(const p of this.pt){const al=Math.floor(p.l*255).toString(16).padStart(2,'0');this.cx.fillStyle=sk.p+al;this.cx.fillRect(p.x-2,p.y-2,4,4);}for(let i=0;i<this.sn.length;i++){const sg=this.sn[i];const al=1-(i/this.sn.length)*.3;this.cx.fillStyle=i===0?sk.s.h:sk.s.b;if(i===0){this.cx.shadowBlur=15;this.cx.shadowColor=sk.s.g;}this.cx.globalAlpha=al;this.cx.fillRect(sg.x*CS,sg.y*CS,CS-2,CS-2);this.cx.globalAlpha=1;this.cx.shadowBlur=0;if(i===0){this.cx.fillStyle='rgba(255,255,255,0.8)';this.cx.fillRect(sg.x*CS+CS/3,sg.y*CS+CS/4,3,3);this.cx.fillRect(sg.x*CS+2*CS/3,sg.y*CS+CS/4,3,3);}}}};
G.prototype.ut=function(){document.getElementById('sc').textContent=this.sc;document.getElementById('lv').textContent=this.lv;document.getElementById('ln').textContent=this.sn.length;document.getElementById('tm').textContent=this.tt+'s';document.getElementById('md').textContent=T[this.ln][MP[this.sm_].n].replace(' Mode','').replace(' Ch·∫ø ƒë·ªô','');const cbc=document.getElementById('cb');if(this.co>0){cbc.classList.remove('hide');document.getElementById('cbv').textContent='x'+this.co;}else{cbc.classList.add('hide');}};
G.prototype.usm=function(){document.getElementById('startmsg').classList.add('hide');};
G.prototype.tp=function(){this.pa=!this.pa;document.getElementById('pause').classList.toggle('hide',!this.pa);};
G.prototype.tmc=function(){this.mcs=!this.mcs;document.getElementById('mctrl').classList.toggle('show',this.mcs);document.getElementById('ctoggle').textContent=this.mcs?'‚úï':'üéÆ';};
G.prototype.eg=function(){this.go=true;this.gs=false;this.mcs=false;document.getElementById('mctrl').classList.remove('show');document.getElementById('ctoggle').textContent='üéÆ';document.getElementById('fs').textContent=this.sc;document.getElementById('bs').textContent=this.sb.b;document.getElementById('cs').textContent=this.sb.c;document.getElementById('ts').textContent=this.sb.t;document.getElementById('fl').textContent=this.lv;document.getElementById('fln').textContent=this.sn.length;document.getElementById('ft').textContent=this.tt+'s';document.getElementById('fc').textContent='x'+Math.max(this.co,0);document.getElementById('over').classList.remove('hide');};
G.prototype.si=function(){this.st_='intro';this.mcs=false;document.getElementById('intro').classList.remove('hide');document.getElementById('map').classList.add('hide');document.getElementById('skin').classList.add('hide');document.getElementById('over').classList.add('hide');document.getElementById('setscr').classList.add('hide');document.getElementById('mctrl').classList.remove('show');document.getElementById('ctoggle').textContent='üéÆ';document.getElementById('startmsg').classList.add('hide');document.body.style.backgroundColor=SK[this.sk_].bg;this.rd();};
G.prototype.bm=function(){this.si();if(this.lp)clearInterval(this.lp);if(this.ti)clearInterval(this.ti);};
G.prototype.sm=function(){this.st_='mapSelect';document.getElementById('intro').classList.add('hide');document.getElementById('map').classList.remove('hide');this.umd();};
G.prototype.ss=function(){this.st_='skinSelect';document.getElementById('intro').classList.add('hide');document.getElementById('skin').classList.remove('hide');};
G.prototype.set=function(){this.st_='settings';document.getElementById('intro').classList.add('hide');document.getElementById('setscr').classList.remove('hide');};
G.prototype.st=function(){this.st_='playing';document.getElementById('map').classList.add('hide');this.ig();this.slp();document.body.style.backgroundColor=SK[this.sk_].bg;};
G.prototype.rs=function(){document.getElementById('over').classList.add('hide');this.ig();this.slp();};
G.prototype.pm=function(){if(this.sm_>0){this.sm_--;this.umd();}};
G.prototype.nm=function(){if(this.sm_<MP.length-1){this.sm_++;this.umd();}};
G.prototype.umd=function(){const m=MP[this.sm_];document.getElementById('mn').textContent=T[this.ln][m.n];document.getElementById('mds').textContent=T[this.ln][m.d];};
G.prototype.rsg=function(){const gr=document.getElementById('sg');gr.innerHTML='';const s=this;Object.keys(SK).forEach(k=>{const sk=SK[k];const cd=document.createElement('div');cd.className='skin-card';if(k===this.sk_)cd.classList.add('active');cd.innerHTML=`<div style="font-weight:bold;margin-bottom:10px" data-t="${sk.name}">${T[s.ln][sk.name]}</div><div class="colors"><div class="color" style="background-color:${sk.s.h}"></div><div class="color" style="background-color:${sk.a};border-radius:50%"></div></div>`;cd.onclick=()=>{s.sk_=k;document.body.style.backgroundColor=SK[k].bg;s.rsg();s.rd();};gr.appendChild(cd);});};
G.prototype.sl=function(l){this.ln=l;['en','vi','ja','ko'].forEach(lg=>document.getElementById('l'+lg).classList.toggle('active',lg===l));document.querySelectorAll('[data-t]').forEach(e=>{const k=e.getAttribute('data-t');if(T[l][k])e.textContent=T[l][k];});this.umd();this.rsg();};
G.prototype.mc=function(d){if(this.go||this.pa)return;let nd=null;if(d==='up')nd={x:0,y:-1};else if(d==='down')nd={x:0,y:1};else if(d==='left')nd={x:-1,y:0};else if(d==='right')nd={x:1,y:0};if(!this.gs){this.gs=true;this.dr=nd;this.nd=nd;this.usm();return;}if(this.sn.length>=2&&nd.x===-this.dr.x&&nd.y===-this.dr.y)return;this.nd=nd;};
const g=new G();
</script>
</body>
</html>